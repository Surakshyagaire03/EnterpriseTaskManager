<div class="container mt-5 text-center">
  <h1 class="display-3 text-primary mb-4">
    Welcome, <%= current_user.first_name.presence || current_user.email %>!
  </h1>

  <div class="mb-3">
    <% if current_user.admin? || current_user.manager? %>
      <%= link_to "Create Task", new_task_path, class: "btn btn-lg btn-success mx-2" %>
    <% end %>

    <%= link_to "View Tasks", tasks_path, class: "btn btn-lg btn-primary mx-2" %>

    <% if current_user.admin? %>
      <%= link_to "Manage Users", admin_users_path, class: "btn btn-lg btn-secondary mx-2" %>
    <% end %>
  </div>
</div>


  <!-- Task Table -->
  <h2 class="mt-5 text-center text-info">Your Tasks</h2>
  <table class="table table-hover table-bordered mt-3">
    <thead class="table-dark">
      <tr class="text-center">
        <th>Title</th>
        <th>Status</th>
        <th>Due Date</th>
        <th>Assignee</th>
        <% if current_user.admin? || current_user.manager? %>
          <th>Creator</th>
          <th>Actions</th>
        <% end %>
      </tr>
    </thead>
    <tbody>
      <% @tasks.each do |task| %>
        <%# Role-aware filtering: Members only see assigned tasks %>
        <% if current_user.admin? || current_user.manager? || task.assignee == current_user %>
          <tr class="text-center">
            <td><strong><%= task.title %></strong></td>
            <td>
              <% case task.status %>
              <% when "pending" %>
                <span class="badge bg-warning text-dark">Pending</span>
              <% when "in_progress" %>
                <span class="badge bg-primary">In Progress</span>
              <% when "completed" %>
                <span class="badge bg-success">Completed</span>
              <% else %>
                <span class="badge bg-secondary">N/A</span>
              <% end %>
            </td>
            <td><%= task.due_date.strftime("%d %b %Y") if task.due_date %></td>
            <td><%= task.assignee&.first_name.presence || task.assignee&.email || "N/A" %></td>
            <% if current_user.admin? || current_user.manager? %>
              <td><%= task.creator&.first_name.presence || task.creator&.email || "N/A" %></td>
              <td class="d-flex justify-content-center gap-1">
                <%= link_to "Edit", edit_task_path(task), class: "btn btn-sm btn-warning" if policy(task).update? %>
                <%= link_to "Delete", task_path(task), method: :delete, data: { confirm: "Are you sure?" }, class: "btn btn-sm btn-danger" if policy(task).destroy? %>
              </td>
            <% end %>
          </tr>
        <% end %>
      <% end %>
    </tbody>
  </table>
</div>
